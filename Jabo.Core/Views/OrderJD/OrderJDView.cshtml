<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>燕翔嘉业货运管理系统</title>
    <meta name="keywords" content="燕翔嘉业货运管理系统">
    <meta name="description" content="燕翔嘉业货运管理系统">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="icon" href="/images/favicon.ico">
    <link rel="stylesheet" href="/lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="/lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
    <link rel="stylesheet" href="/css/layuimini.css?v=2.0.1" media="all">
    <link rel="stylesheet" href="/css/themes/default.css" media="all">
    <link rel="stylesheet" href="/css/public.css" media="all">
    <style id="layuimini-bg-color">
    </style>
</head>
<body class="layui-layout-body layuimini-all">
    <div class="layuimini-main">
        <div class="layui-form layuimini-form" lay-filter="example">
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">项目名称</label>
                    <div class="layui-input-inline">
                        <select lay-verify="" class="projectCode" disabled name="projectCode">
                            <option value="">请选择</option>
                        </select>
                        <input type="hidden" name="orderId">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">单号</label>
                    <div class="layui-input-inline">
                        <input type="text" name="orderNo" disabled value="" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">封签号</label>
                    <div class="layui-input-inline">
                        <input type="text" name="sealNo" disabled value="" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">日期</label>
                    <div class="layui-input-inline">
                        <input type="text" name="orderDate" id="orderDate" disabled" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">出发时间</label>
                    <div class="layui-input-inline">
                        <input type="text" name="startTime" id="startTime" disabled autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">到站时间</label>
                    <div class="layui-input-inline">
                        <input type="text" name="endTime" id="endTime" disabled autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">车号</label>
                    <div class="layui-input-inline">
                        <input type="text" name="carNo" disabled value="" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">司机</label>
                    <div class="layui-input-inline">
                        <input type="text" name="driver" disabled value="" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">托拍数</label>
                    <div class="layui-input-inline">
                        <input type="number" name="beats" disabled value="" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">始发站</label>
                    <div class="layui-input-inline">
                        <select lay-verify="" class="departure" disabled lay-filter="departure" name="departure">
                            <option value="">请选择</option>
                        </select>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">目的地</label>
                    <div class="layui-input-inline">
                        <select lay-verify="" class="terminal" disabled lay-filter="terminal" name="terminal">
                            <option value="">请选择</option>
                        </select>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">车型</label>
                    <div class="layui-input-inline">
                        <select lay-verify="" class="carTypeCode" disabled lay-filter="carTypeCode" name="carTypeCode">
                            <option value="">请选择</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">里程</label>
                    <div class="layui-input-inline">
                        <input type="number" name="mileage" disabled value="" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">运费</label>
                    <div class="layui-input-inline">
                        <input type="number" id="cost" name="cost" disabled value="0" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">回扣</label>
                    <div class="layui-input-inline">
                        <input type="number" name="rebate" id="rebate" disabled value="0" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">结款运费</label>
                    <div class="layui-input-inline">
                        <input type="number" name="freight" disabled value="0" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">高速费</label>
                    <div class="layui-input-inline">
                        <input type="number" name="highspeedCharge" disabled value="" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">油卡余额</label>
                    <div class="layui-input-inline">
                        <input type="number" name="oilCardBalance" disabled value="" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">公里数</label>
                    <div class="layui-input-inline">
                        <input type="number" name="kilometers"  disabled value="" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">油卡充值</label>
                    <div class="layui-input-inline">
                        <input type="number" name="oilCardTopup" disabled value="" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">用油情况</label>
                    <div class="layui-input-inline">
                        <input type="number" name="oilCardUse"  disabled value="" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">修车费</label>
                    <div class="layui-input-inline">
                        <input type="number" name="repairfee" disabled value="" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">车辆罚款</label>
                    <div class="layui-input-inline">
                        <input type="number" name="fine" disabled value="" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">速通卡</label>
                    <div class="layui-input-inline">
                        <input type="number" name="suTongCard" disabled value="" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-block">
                    <label class="layui-form-label">支付现金</label>
                    <div class="layui-input-block">
                        <input type="number" name="paycash" disabled value="" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-block">
                    <label class="layui-form-label">备注</label>
                    <div class="layui-input-block">
                        <textarea placeholder="请输入内容" disabled name="remark" class="layui-textarea"></textarea>
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-block">
                    <div class="layui-input-block">
                        <button class="layui-btn layui-btn-primary" id="btnClose" lay-filter="btnClose">取消</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="/lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
    <script src="/lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
    <script src="/js/lay-config.js?v=2.0.0" charset="utf-8"></script>
    <script>
        layui.use(['form', 'layer', 'laydate', 'tableSelect', 'layarea'], function () {
            var form = layui.form,
                laydate = layui.laydate,
                layarea = layui.layarea;

            var router = layui.router();

            //日期
            laydate.render({
                elem: '#orderDate'
            });
            laydate.render({
                elem: '#startTime',
                type: 'time'
            });
            laydate.render({
                elem: '#endTime',
                type: 'time'
            });

            //加载项目
            $.get("/Dic/GetDicListByTypeCode", { dicTypeCode: "ProjectName" }, function (jsonProject) {
                if (jsonProject.Result) {
                    JSON.parse(jsonProject.DataValue).forEach(function (item, index, arr) {
                        $(".projectCode").append("<option value='" + item.dicCode + "'>" + item.dicName + "</option>");
                    });
                }

                //加载始发地
                $.get("/JDItinerary/GetDeparture", {}, function (jsonDeparture) {
                    if (jsonDeparture) {
                        jsonDeparture.forEach(function (item, index, arr) {
                            $(".departure").append("<option value='" + item + "'>" + item + "</option>");
                        });
                    }

                    if (router.search.orderNo != undefined && router.search.orderNo !== "") {
                        $.get("/OrderJD/GetOrderJDByOrderNo", { orderNo: router.search.orderNo }, function (json) {

                            //加载目的地
                            $.get("/JDItinerary/GetTerminal", { departure: json.departure }, function (jsonTerminal) {
                                $(".terminal").empty();
                                $(".terminal").html('<option value="">请选择</option>');
                                if (jsonTerminal.Result) {
                                    JSON.parse(jsonTerminal.DataValue).forEach(function (item, index, arr) {
                                        $(".terminal").append("<option value='" + item.terminal + "'  data-code='" + item.jDItineraryCode + "' data-mileage='" + item.mileage + "' >"
                                            + item.terminal + "</option>");
                                    });

                                    //表单初始赋值
                                    form.val('example', {
                                        "orderId": json.orderId, "projectCode": json.projectCode, "orderNo": json.orderNo
                                        , "sealNo": json.sealNo, "orderDate": json.orderDate.substr(0, 10), "startTime": json.startTime
                                        , "endTime": json.endTime, "carNo": json.carNo, "driver": json.driver
                                        , "departure": json.departure, "terminal": json.terminal
                                        , "beats": json.beats, "mileage": json.mileage, "highspeedCharge": json.highspeedCharge
                                        , "cost": json.cost, "rebate": json.rebate, "freight": json.freight
                                        , "oilCardBalance": json.oilCardBalance, "kilometers": json.kilometers, "oilCardTopup": json.oilCardTopup
                                        , "oilCardUse": json.oilCardUse, "repairfee": json.repairfee, "fine": json.fine
                                        , "suTongCard": json.suTongCard, "paycash": json.paycash, "remark": json.remark
                                    });

                                    //货车类型
                                    $.get("/JDItineraryCost/GetJDItineraryCosts", { jDItineraryCode: $(".terminal option:selected").attr("data-code") }, function (jsonCarType) {
                                        $(".carTypeCode").empty();
                                        $(".carTypeCode").html('<option value="">请选择</option>');
                                        if (jsonCarType.Result) {
                                            JSON.parse(jsonCarType.DataValue).forEach(function (item, index, arr) {
                                                $(".carTypeCode").append("<option value='" + item.carTypeCode + "' data-cost='" + item.cost + "' >" + item.carType + "</option>");
                                            });

                                            //表单初始赋值
                                            form.val('example', { "carTypeCode": json.carTypeCode });
                                        }
                                    });
                                }
                            });
                        });
                    }
                });
            });

            /**
             * 初始化表单，要加上，不然刷新部分组件可能会不加载
             */
            form.render();

            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引

            layui.$('#btnClose').on('click', function () {
                parent.layer.close(index); //再执行关闭
            });
        });</script>
</body>
</html>
